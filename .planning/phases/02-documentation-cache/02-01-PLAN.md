---
phase: 02-documentation-cache
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/cache/paths.ts
  - src/lib/cache/types.ts
  - src/lib/cache/downloader.ts
  - src/lib/cache/downloader.test.ts
autonomous: true

must_haves:
  truths:
    - "Cache directory path is defined for ~/.gsdo/cache/docs-opencode/"
    - "Downloader fetches OpenCode docs from GitHub"
    - "Downloader creates cache directory if not exists"
    - "Downloader writes timestamp metadata after successful download"
    - "Downloader handles network failures gracefully (returns error, doesn't crash)"
  artifacts:
    - path: "src/lib/cache/paths.ts"
      provides: "Cache directory path resolution"
      exports: ["getGsdoCachePath", "getDocsOpenCodeCachePath"]
      min_lines: 20
    - path: "src/lib/cache/types.ts"
      provides: "Cache metadata type definitions"
      exports: ["CacheMetadata", "DownloadResult"]
      min_lines: 15
    - path: "src/lib/cache/downloader.ts"
      provides: "GitHub documentation download logic"
      exports: ["downloadOpenCodeDocs"]
      min_lines: 60
    - path: "src/lib/cache/downloader.test.ts"
      provides: "Downloader test coverage"
      contains: "describe('downloadOpenCodeDocs'"
      min_lines: 40
  key_links:
    - from: "src/lib/cache/downloader.ts"
      to: "src/lib/cache/paths.ts"
      via: "imports getDocsOpenCodeCachePath"
      pattern: "import.*getDocsOpenCodeCachePath"
    - from: "src/lib/cache/downloader.ts"
      to: "GitHub API"
      via: "fetch() to raw.githubusercontent.com"
      pattern: "fetch.*githubusercontent\\.com"
    - from: "src/lib/cache/downloader.ts"
      to: "fs (writeFile, mkdir)"
      via: "writes docs and metadata.json"
      pattern: "writeFile.*metadata\\.json"
---

<objective>
Create cache infrastructure and GitHub documentation downloader for OpenCode docs.

Purpose: Enable /gsdo command to have OpenCode documentation context for LLM enhancement. This phase establishes the foundation for caching by defining paths, types, and implementing the actual download mechanism with proper error handling.

Output: Cache path utilities, type definitions, and a working downloader that fetches OpenCode docs from GitHub and writes them to ~/.gsdo/cache/docs-opencode/ with timestamp metadata.
</objective>

<execution_context>
@C:\Users\Terence\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\Terence\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing code to understand patterns
@src/lib/paths.ts
@src/lib/detector.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Cache Path Infrastructure</name>
  <files>
    src/lib/cache/paths.ts
    src/lib/cache/types.ts
  </files>
  <action>
Create cache path resolution module following existing patterns from src/lib/paths.ts.

**src/lib/cache/paths.ts:**
- Export `getGsdoCachePath()`: Returns ~/.gsdo/cache/ (base cache directory)
- Export `getDocsOpenCodeCachePath()`: Returns ~/.gsdo/cache/docs-opencode/ (OpenCode docs cache)
- Use `resolveHome()` pattern from src/lib/paths.ts for cross-platform home directory resolution
- Import homedir, join, normalize from Node.js built-ins only

**src/lib/cache/types.ts:**
- Define `CacheMetadata` interface with fields: `downloadedAt` (ISO timestamp string), `source` (GitHub URL), `version` (optional string)
- Define `DownloadResult` interface with fields: `success` (boolean), `error?` (string), `cached` (boolean - true if used existing cache)
- Keep types minimal and focused on caching needs

**Why these patterns:**
- Follows established path resolution from Phase 1 (Node.js built-ins only)
- Separates concerns (paths vs types) for clean imports
- `~/.gsdo/` prefix keeps all tool state in one place (not polluting OpenCode's directories)
  </action>
  <verify>
Run `npm run build` - TypeScript compilation succeeds with no errors.
Check exports: `grep -E "export (function|interface)" src/lib/cache/paths.ts src/lib/cache/types.ts`
  </verify>
  <done>
- src/lib/cache/paths.ts exports getGsdoCachePath and getDocsOpenCodeCachePath functions
- src/lib/cache/types.ts exports CacheMetadata and DownloadResult interfaces
- TypeScript compiles without errors
- Paths use Node.js built-in modules only (no external dependencies)
  </done>
</task>

<task type="auto">
  <name>Task 2: GitHub Documentation Downloader</name>
  <files>
    src/lib/cache/downloader.ts
    src/lib/cache/downloader.test.ts
  </files>
  <action>
Create documentation downloader that fetches OpenCode docs from GitHub and caches them locally.

**src/lib/cache/downloader.ts:**

Export `downloadOpenCodeDocs()` async function:
1. **Target:** Fetch README from https://raw.githubusercontent.com/OpenAgentsInc/opencode/main/README.md
2. **Cache directory:** Create ~/.gsdo/cache/docs-opencode/ using mkdirSync with recursive: true
3. **Write docs:** Save README content to `{cacheDir}/README.md`
4. **Write metadata:** Save metadata.json with structure:
   ```json
   {
     "downloadedAt": "2026-01-22T20:00:00.000Z",
     "source": "https://raw.githubusercontent.com/OpenAgentsInc/opencode/main/README.md"
   }
   ```
5. **Error handling:**
   - Wrap fetch in try/catch
   - On network error: Return `{ success: false, error: "Network error: ${message}", cached: false }`
   - On HTTP error (status !== 200): Return `{ success: false, error: "HTTP ${status}", cached: false }`
   - On write error: Return `{ success: false, error: "Write failed: ${message}", cached: false }`
   - On success: Return `{ success: true, cached: false }`
6. **Imports:** Use fetch (Node.js built-in since Node 18), fs.writeFile, fs.mkdir from node:fs/promises, path utilities from ./paths.js

**src/lib/cache/downloader.test.ts:**
- Test successful download (mocked fetch)
- Test network error handling (mocked fetch throws)
- Test HTTP error handling (mocked fetch returns 404)
- Test cache directory creation (verify mkdirSync called)
- Test metadata.json structure (correct timestamp, source URL)

Use Vitest patterns from existing test files in the project.

**Why this approach:**
- Single README file is sufficient for v1 (can expand to multiple docs later)
- Metadata separate from content allows version checking without parsing README
- Graceful error handling allows installer to continue even if download fails
- Node.js built-in fetch avoids external HTTP client dependencies
  </action>
  <verify>
Run `npm test` - all downloader tests pass.
Run `npm run build` - TypeScript compilation succeeds.
  </verify>
  <done>
- downloadOpenCodeDocs() function fetches README from GitHub
- Cache directory ~/.gsdo/cache/docs-opencode/ is created on download
- metadata.json written with downloadedAt timestamp and source URL
- Network errors return { success: false, error: "..." } without crashing
- All tests pass
  </done>
</task>

</tasks>

<verification>
**Automated checks:**
```bash
npm test  # All tests pass including new downloader tests
npm run build  # TypeScript compilation succeeds
```

**Manual verification:**
```bash
# Run CLI to trigger download
npm run dev

# Check cache was created
ls ~/.gsdo/cache/docs-opencode/
# Should see: README.md, metadata.json

# Check metadata structure
cat ~/.gsdo/cache/docs-opencode/metadata.json
# Should see: {"downloadedAt":"2026-...", "source":"https://..."}

# Verify README content
head -20 ~/.gsdo/cache/docs-opencode/README.md
# Should contain OpenCode README content from GitHub
```
</verification>

<success_criteria>
**Must be TRUE:**
1. Cache paths defined in src/lib/cache/paths.ts resolve to ~/.gsdo/cache/docs-opencode/
2. CacheMetadata and DownloadResult types exported from src/lib/cache/types.ts
3. downloadOpenCodeDocs() successfully fetches README from GitHub on network success
4. Cache directory created at ~/.gsdo/cache/docs-opencode/ with README.md and metadata.json
5. metadata.json contains valid ISO timestamp and GitHub source URL
6. Network failures return DownloadResult with success: false, not crashes
7. All tests pass (including downloader tests)
8. TypeScript compilation succeeds with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-documentation-cache/02-01-SUMMARY.md`
</output>
