---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/lib/manifesto.ts
  - src/cli.ts
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User sees Notice text when running CLI"
    - "User is prompted to accept or decline the manifesto"
    - "User who accepts continues to main flow"
    - "User who declines sees graceful exit message"
    - "Declining manifesto exits with code 0 (not an error)"
  artifacts:
    - path: "src/lib/manifesto.ts"
      provides: "Notice display and consent logic"
      exports: ["showManifesto"]
      min_lines: 40
    - path: "src/cli.ts"
      provides: "CLI with manifesto integration"
      contains: "showManifesto"
  key_links:
    - from: "src/cli.ts"
      to: "src/lib/manifesto.ts"
      via: "import showManifesto"
      pattern: "import.*showManifesto.*from.*manifesto"
    - from: "src/lib/manifesto.ts"
      to: "@clack/prompts"
      via: "confirm prompt"
      pattern: "confirm\\("
---

<objective>
Add the Notice disclaimer and consent flow to the CLI.

Purpose: Establish expectation management with users before any operations. The manifesto is both humor and genuine disclaimer about "best effort" nature of transpilation.

Output: Users see the Notice on launch, must accept to continue, and can gracefully decline.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Notice module with consent flow</name>
  <files>
    src/lib/manifesto.ts
  </files>
  <action>
    Create src/lib/manifesto.ts:

    Import { intro, outro, confirm, isCancel } from '@clack/prompts'
    Import pc from 'picocolors'

    Export async function showManifesto(): Promise<boolean>

    The function should:
    1. Call intro() with styled title using picocolors
    2. Display the Notice text with ASCII art border (use console.log)
    3. Use confirm() to ask "Do you accept and wish to continue?"
       - Set initialValue: false (require explicit acceptance)
    4. Handle isCancel() - if user presses Ctrl+C, treat as decline
    5. If declined or cancelled:
       - Call outro() with "Manifesto declined. Safe travels, user."
       - Return false
    6. If accepted:
       - Log acceptance timestamp (verbose level)
       - Return true

    Manifesto content should include:
    - ASCII art header "THE HOBO MANIFESTO"
    - Clear disclaimer about "best effort" transpilation
    - List of limitations (not perfect migration, some features won't translate)
    - Acknowledgment of GSD/glittercowboy as original author
    - Hobo-themed closing ("By continuing, you accept these limitations and board the freight train.")

    Use picocolors for styling:
    - pc.bold() for headers
    - pc.yellow() for warning text
    - pc.dim() for fine print

    CRITICAL: Use isCancel() to handle Ctrl+C gracefully - don't let it crash.
    CRITICAL: initialValue must be false to require explicit acceptance (clickwrap pattern).
  </action>
  <verify>
    - `npx tsx -e "import { showManifesto } from './src/lib/manifesto.js'; showManifesto().then(console.log)"` displays manifesto and prompts
    - Pressing 'n' returns false
    - Pressing 'y' returns true
    - Pressing Ctrl+C returns false (no crash)
  </verify>
  <done>
    Manifesto module displays formatted disclaimer, prompts for consent, handles all response types gracefully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate manifesto into CLI flow</name>
  <files>
    src/cli.ts
  </files>
  <action>
    Modify src/cli.ts to integrate the manifesto:

    Add import: import { showManifesto } from './lib/manifesto.js'

    In the .action() handler, after setLogLevel():
    1. Call const accepted = await showManifesto()
    2. If !accepted:
       - Set process.exitCode = ExitCode.SUCCESS (declining is not an error)
       - Return early (don't proceed with main logic)
    3. If accepted:
       - Continue with existing placeholder logic
       - Add log.success('Ready to transpile!') as new placeholder

    The flow should be:
    1. Parse flags
    2. Set log level
    3. Show manifesto
    4. If declined -> exit 0
    5. If accepted -> continue (placeholder for now)

    IMPORTANT: Keep the existing --help and --version behavior. Commander handles those before .action() runs, so manifesto won't show for --help/--version.

    IMPORTANT: In quiet mode (-q), the manifesto should still show (consent is mandatory).
  </action>
  <verify>
    - `npm run dev` shows manifesto and prompts
    - Accepting manifesto shows "Ready to transpile!" message
    - Declining manifesto shows "Manifesto declined" and exits cleanly
    - `npm run dev -- --help` still shows help (no manifesto)
    - `npm run dev -- --version` still shows version (no manifesto)
    - After decline: `echo $?` shows 0 (not error code)
  </verify>
  <done>
    CLI shows manifesto on launch, handles accept/decline correctly, --help and --version bypass manifesto.
  </done>
</task>

<task type="auto">
  <name>Task 3: End-to-end verification of all Phase 1 requirements</name>
  <files>
    (no new files - verification only)
  </files>
  <action>
    Run comprehensive verification of all CLI-01 through CLI-07 requirements:

    CLI-01 (Manifesto): Run `npm run dev`, verify manifesto displays, accept it
    CLI-02 (Help): Run `npm run dev -- --help`, verify all flags shown
    CLI-03 (Version): Run `npm run dev -- --version`, verify "0.1.0" shown
    CLI-04 (Exit codes): Run commands and check exit codes with `echo $?` or `$LASTEXITCODE` (PowerShell)
    CLI-05 (Verbose): Run `npm run dev -- -v`, accept manifesto, verify verbose output
    CLI-06 (Dry-run): Run `npm run dev -- --dry-run`, accept manifesto, verify dry-run message
    CLI-07 (Quiet): Run `npm run dev -- -q`, accept manifesto, verify minimal output

    Also verify:
    - Build works: `npm run build` produces dist/cli.js
    - Built CLI works: `node dist/cli.js --help`

    Document any issues found. If all pass, Phase 1 is complete.
  </action>
  <verify>
    All 7 CLI requirements verified working:
    - CLI-01: Manifesto displays with accept/decline
    - CLI-02: --help shows usage
    - CLI-03: --version shows 0.1.0
    - CLI-04: Exit codes correct (0 success, 2 error)
    - CLI-05: -v enables verbose output
    - CLI-06: --dry-run shows preview message
    - CLI-07: -q suppresses non-error output
  </verify>
  <done>
    All Phase 1 requirements verified. CLI is ready for Phase 2 (Detection).
  </done>
</task>

</tasks>

<verification>
Run the following to verify Phase 1 Plan 02 completion:

```bash
# Test manifesto display and acceptance
npm run dev
# (press 'y' to accept)

# Test manifesto decline
npm run dev
# (press 'n' to decline, verify exit code 0)

# Verify help still works
npm run dev -- --help

# Verify version still works
npm run dev -- --version

# Verify verbose mode with manifesto
npm run dev -- -v
# (accept, verify verbose output)

# Verify quiet mode with manifesto
npm run dev -- -q
# (accept, verify minimal output after manifesto)

# Verify dry-run with manifesto
npm run dev -- --dry-run
# (accept, verify dry-run message)

# Verify build
npm run build && node dist/cli.js --help
```

All commands should work correctly with manifesto integrated.
</verification>

<success_criteria>
- [ ] Manifesto displays on `npm run dev` with ASCII art and disclaimer text
- [ ] User must explicitly press 'y' to accept (not pre-checked)
- [ ] Accepting manifesto allows CLI to continue
- [ ] Declining manifesto exits gracefully with message
- [ ] Ctrl+C during prompt is handled gracefully (no crash)
- [ ] Declining manifesto exits with code 0 (not error)
- [ ] --help and --version bypass manifesto (Commander handles them first)
- [ ] All CLI-01 through CLI-07 requirements verified working
- [ ] `npm run build` produces working dist/cli.js
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
